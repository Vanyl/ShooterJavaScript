<html>

<head>
    <script src="/ShooterJavaScript/PhaserLib/phaser.min.js"></script>
    <title> </title>
</head>

<body>
    <script type="text/javascript">
        var config = {
            type: Phaser.AUTO,
            width: 360,
            height: 640,
            physics: {
                default: 'arcade'
            },
            scene: {
                preload: preload,
                create: create,
                //update: update
            }
        };

        var game = new Phaser.Game(config);

        var sprite1, sprite2, choice1, choice1;
        var testObject, answer_1, answer_2;
        var answer, question, imageQuestion, imageAnswer; //tableaux question_sprite, answer_sprite

        var currentIndex = 0;
        //var answerIndex = 0;
        var questionId = 0;

        function preload() {
            this.load.image('question', './Assets/bulleconvers.png');
            this.load.image('reponse', './Assets/bulleconvers2.png');
            this.load.image('choice', './Assets/bulleconvers3.png');
            this.load.text('SequenceQR', 'SequenceQR.json')
        }


        function create() {
            this.cameras.main.setBackgroundColor(0xbababa);

            //Tableaux pour manipuler dynamique scrolling
            question = new Array(40);
            answer = new Array(40);
            imageAnswer = new Array(40);
            imageQuestion = new Array(40);

            //Rajout des bulles conversations (variable sprite)            
            imageQuestion[currentIndex] = this.add.sprite(175, 460, 'question');
            sprite1 = this.add.sprite(90, 610, 'choice').setInteractive();
            sprite2 = this.add.sprite(270, 610, 'choice').setInteractive();

            //Rajout fichier JSON
            testObject = JSON.parse(this.cache.text.get("SequenceQR"));

            //Lien bulle/texte (variable texte)            
            question[questionId] = this.add.text(10, 450, testObject.Sequence[questionId].question);

            choice1 = this.add.text(5, 605, testObject.Sequence[questionId].answer1);
            choice2 = this.add.text(195, 605, testObject.Sequence[questionId].answer2);

            this.input.on('gameobjectover', function(pointer, sprite1) {
                sprite1.setTint(0x7d7d7d);
            });
            this.input.on('gameobjectout', function(pointer, sprite1) {
                sprite1.clearTint();
            });

            //Event clic
            sprite1.on('pointerdown', addResponse1, this);
            sprite2.on('pointerdown', addResponse2, this);
        }

        function addResponse1() {
            //ajout sprite réponse qd clique sur choice
            imageAnswer[currentIndex] = this.add.sprite(155, 545, 'reponse');
            answer[currentIndex] = this.add.text(15, 535, testObject.Sequence[questionId].answer1);

            //ajout sprite question qd clique sur choice
            /* imageQuestion[0] = this.add.sprite(155, 450, 'question');            
             question[questionIndex] = this.add.text(15, 443, testObject.Sequence[currentId].question1);*/

            //Monte la réponse
            var tween = this.tweens.add({
                targets: answer[currentIndex],
                y: 375,
                ease: 'Power1',
                duration: 3000
            })
            //Monte sprite réponse
            var tween = this.tweens.add({
                targets: imageAnswer[currentIndex],
                y: 380,
                ease: 'Power1',
                duration: 3000
            })
            var tween2 = this.tweens.add({
                targets: question[currentIndex],
                y: 305,
                /*335*/
                ease: 'Power1',
                duration: 3000
            })
            //Monte sprite question
            var tween3 = this.tweens.add({
                targets: imageQuestion[currentIndex],
                y: 310,
                ease: 'Power1',
                duration: 3000
            })
            currentIndex++;

            //Timer
            var timer_appearance = this.time.addEvent({
                delay: 1000,
                callback: appearanceAnswer,
                callbackScope: this,
                repeat: 0

            });    
        }

        function addResponse2() {
            imageAnswer[currentIndex] = this.add.sprite(155, 545, 'reponse');
            //var answer_sprite = 
            answer[currentIndex] = this.add.text(15, 535, testObject.Sequence[questionId].answer2);

            //Monte texte réponse
            var tween = this.tweens.add({
                targets: answer[currentIndex],
                y: 375,
                ease: 'Power1',
                duration: 3000
            })
            //Monte sprite réponse
            var tween = this.tweens.add({
                targets: imageAnswer[currentIndex],
                y: 380,
                ease: 'Power1',
                duration: 3000
            })
            //Monte texte question
            var tween2 = this.tweens.add({
                targets: question[currentIndex],
                y: 305,
                /*300*/
                ease: 'Power1',
                duration: 3000
            })
            // Monte sprite question
            var tween3 = this.tweens.add({
                targets: imageQuestion[currentIndex],
                y: 310,
                ease: 'Power1',
                duration: 3000
            })
            currentIndex++;

            //Timer
            var timer_appearance = this.time.addEvent({
                delay: 1000,
                callback: appearanceAnswer,
                callbackScope: this,
                repeat: 0

            });
        }


        function appearanceAnswer() {

            questionId = testObject.Sequence[questionId].ifquestion2;
            imageQuestion[currentIndex] = this.add.sprite(175, 545, 'question');
            question[currentIndex] = this.add.text(10, 543, testObject.Sequence[questionId].question);
            //question.text = testObject.Sequence[questionId].question;
            choice2.text = testObject.Sequence[questionId].answer2;
            choice1.text = testObject.Sequence[questionId].answer1;

            //Monte texte question
            var tween2 = this.tweens.add({
                targets: question[currentIndex],
                y: 443,
                /*300*/
                ease: 'Power1',
                duration: 3000
            })
            // Monte sprite question
            var tween3 = this.tweens.add({
                targets: imageQuestion[currentIndex],
                y: 450,
                /*305*/
                ease: 'Power1',
                duration: 3000
            })
        }
    </script>

</body></html>
