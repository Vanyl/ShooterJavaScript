<html>

<head>
    <script src="/ShooterJavaScript/PhaserLib/phaser.min.js"></script>
    <title> </title>
</head>

<body>
    <script type="text/javascript">
        var config = {
            type: Phaser.AUTO,
            width: 360,
            height: 640,
            physics: {
                default: 'arcade'
            },
            scene: {
                preload: preload,
                create: create,
                //update: update
            }
        };

        var game = new Phaser.Game(config);

        var sprite1, sprite2, choice1, choice1;
        var testObject, answer_1, answer_2;
        var answer, question, imageQuestion, imageAnswer; //tableaux question_sprite, answer_sprite

        var currentid;
        var answerIndex = 0;
        var questionIndex = 0;

        function preload() {
            this.load.image('question', './Assets/bulleconvers.png');
            this.load.image('reponse', './Assets/bulleconvers2.png');
            this.load.image('choice', './Assets/bulleconvers3.png');
            this.load.text('SequenceQR', 'SequenceQR.json')
        }


        function create() {
            this.cameras.main.setBackgroundColor(0xbababa);

            //Tableaux pour manipuler dynamique scrolling
            question = new Array(40);
            answer = new Array(40);
            imageAnswer = new Array(40);
            imageQuestion = new Array(40);
            
            //Rajout des bulles conversations (variable sprite)            
            imageQuestion[0] = this.add.sprite(175, 450, 'question');
            sprite1 = this.add.sprite(90, 610, 'choice').setInteractive();
            sprite2 = this.add.sprite(270, 610, 'choice').setInteractive();

            //Rajout fichier JSON
            testObject = JSON.parse(this.cache.text.get("SequenceQR"));
            currentid = 0;
            
            //Lien bulle/texte (variable texte)            
            question[0] = this.add.text(10, 443, testObject.Sequence[currentid].question);

            choice1 = this.add.text(5, 605, testObject.Sequence[currentid].answer1);
            choice2 = this.add.text(195, 605, testObject.Sequence[currentid].answer2);

            this.input.on('gameobjectover', function(pointer, sprite1) {
                sprite1.setTint(0x7d7d7d);
            });
            this.input.on('gameobjectout', function(pointer, sprite1) {
                sprite1.clearTint();
            });

            //Event clic
            sprite1.on('pointerdown', addResponse1, this);
            sprite2.on('pointerdown', addResponse2, this);
        }

        function addResponse1() {
            //ajout sprite réponse qd clique sur choice
            imageAnswer[0] = this.add.sprite(155, 545, 'reponse');
            answer[answerIndex] = this.add.text(15, 535, testObject.Sequence[currentid].answer1);

            //ajout sprite question qd clique sur choice
            /* imageQuestion[0] = this.add.sprite(155, 450, 'question');            
             question[questionIndex] = this.add.text(15, 443, testObject.Sequence[currentid].question1);*/

            //Monte la réponse
            var tween = this.tweens.add({
                targets: answer[answerIndex],
                y: 375,
                ease: 'Power1',
                duration: 3000
            })
            //Monte sprite réponse
            var tween = this.tweens.add({
                targets: imageAnswer[answerIndex],
                y: 380,
                ease: 'Power1',
                duration: 3000
            })
            answerIndex++;

            currentid = testObject.Sequence[currentid].ifquestion1;
            question.text = testObject.Sequence[currentid].question;
            choice1.text = testObject.Sequence[currentid].answer1;
            choice2.text = testObject.Sequence[currentid].answer2;

            question[currentid] = this.add.text(10, 443, testObject.Sequence[currentid].question);

            //Monte question
            var tween2 = this.tweens.add({
                targets: question[questionIndex],
                y: 300,
                /*335*/
                ease: 'Power1',
                duration: 2000
            })
            //Monte sprite question
            var tween3 = this.tweens.add({
                targets: imageQuestion[questionIndex],
                y: 305,
                ease: 'Power1',
                duration: 3000
            })
            questionIndex++;
        }

        function addResponse2() {
            imageAnswer[0] = this.add.sprite(155, 545, 'reponse');
            //var answer_sprite = 
            answer[answerIndex] = this.add.text(15, 535, testObject.Sequence[currentid].answer2);

            //Monte texte réponse
            var tween = this.tweens.add({
                targets: answer[answerIndex],
                y: 375,
                ease: 'Power1',
                duration: 3000
            })
            //Monte sprite réponse
            var tween = this.tweens.add({
                targets: imageAnswer[answerIndex],
                y: 380,
                ease: 'Power1',
                duration: 3000
            })
            answerIndex++;

            currentid = testObject.Sequence[currentid].ifquestion2;
            question.text = testObject.Sequence[currentid].question;
            choice2.text = testObject.Sequence[currentid].answer2;
            choice1.text = testObject.Sequence[currentid].answer1;

            question[currentid] = this.add.text(10, 443, testObject.Sequence[currentid].question);

            //Monte texte question
            var tween2 = this.tweens.add({
                targets: question[questionIndex],
                y: 300,
                /*300*/
                ease: 'Power1',
                duration: 2000
            })
            // Monte sprite question
            var tween3 = this.tweens.add({
                targets: imageQuestion[questionIndex],
                y: 305,
                ease: 'Power1',
                duration: 3000
            })
            questionIndex++;
        }
    </script>

</body></html>
